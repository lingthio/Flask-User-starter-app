{% extends "layout.html" %}

{% block content %}
{% include 'js_util.html' %}
<script type="text/javascript" class="init">

    // Save meta data like project id, user id and role
    let project_id = {{data.current_project.id}};
    let user_id = {{data.user.id}};
    let role = '{{data.role}}';

    $(document).ready(function () {
        // Table definition
        $('#admin_overview_table').DataTable({
            serverSide: true,
            ajax: {
                url: "/data/projects_data",
                beforeSend: function (request) {
                    request.setRequestHeader("project_id", project_id);
                    request.setRequestHeader("user_id", user_id);
                    request.setRequestHeader("role", role);
                },
                data: function ( args ) {
                    return { "args": JSON.stringify( args ) };
                }
            },
            columns: [
                {
                    name: 'name',
                    data: 'name'
                },
                {
                    name: 'status',
                    data: null,
                    render: function(data){return createStatusLabel(data);}
                },
                {
                    data: null,
                    render: function (data, type, row) {
                        return '<button class="btn btn-danger reviewButton">Review</i></button>';
                    }
                },
                {
                    data: null,
                    render: function (data, type, row) {
                        return '<button class="btn btn-primary dataDownloadButton">Download</i></button>';
                    }
                },

            ],
            columnDefs: [{"className": "dt-center", "targets": "_all"}],
            autoWidth: false
        });

         // Buttons/checkboxes functionality
        $('#admin_overview_table').on('draw.dt', function () {

            // Review dialog
            $('.reviewButton').click(function () {
                // Retrieve the data belonging to this specific row
                let table = $('#admin_overview_table').DataTable();
                let imageObj = table.row($(this).closest('tr')).data();

                showReviewModal(imageObj)
            });

            //Row data dialog
            $('.dataEditButton').click(function () {
                // Retrieve the data belonging to a specific row
                let table = $('#admin_overview_table').DataTable();
                let data = table.row($(this).closest('tr')).data();
                console.log(table.ajax.json());

                // Populate data
                $('#dataModalHeaderTitle').html(data["name"]);
                $('#segmentation-download-btn').attr("value", data["id"]);
                $('#segmentation-upload-btn').attr("value", data["id"]);
                $('#dataModal').modal("show");
            });

            // Download data
            $('.dataDownloadButton').click(function () {
                let table = $('#admin_overview_table').DataTable();
                let rowObject = table.row($(this).closest('tr')).data();
                showDownloadModal(rowObject);

            });
        });

    });

</script>
<table id="admin_overview_table" class="table table-striped table-hover dt-responsive nowrap">
    <thead>
    <tr>
        <th> Data ID </th>
        <th> Status </th>
        <th> Review </th>
        <th> Data </th>
    </tr>
    </thead>
</table>

{% endblock %}

{% block forms %}
{% include 'forms/review_form.html' %}
{% include 'forms/download_form.html' %}
{% endblock %}
