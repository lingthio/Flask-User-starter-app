{% extends "layout.html" %}

{% block content %}
{% include 'js_util.html' %}
<script type="text/javascript" class="init">


    // Save meta data like project id, user id and role
    let project_id = {{data.current_project.id}};
    let user_id = {{data.user.id}};
    let role = '{{data.role}}';


    $(document).ready(function () {
        // Table definition
        $('#admin_overview_table').DataTable({
            serverSide: true,
            ajax: {
                url: "/data/projects_data",
                beforeSend: function (request) {
                    request.setRequestHeader("project_id", project_id);
                    request.setRequestHeader("user_id", user_id);
                    request.setRequestHeader("role", role);
                },
                data: function ( args ) {
                    return { "args": JSON.stringify( args ) };
                }
            },
            columns: [
                {
                    name: 'name',
                    data: 'name'
                },
                {
                    name: 'status',
                    data: null,
                    render: function(data){return createStatusLabel(data);}
                },
                {
                    data: null,
                    render: function (data, type, row) {
                        return '<button class="btn btn-primary segmentationUploadButton">Upload</button> ' +
                            '<button style="margin-left: 30px" class="btn btn-primary dataDownloadButton">Download</button>';
                    }
                },

            ],
            columnDefs: [{"className": "dt-center", "targets": "_all"}],
            autoWidth: false
        });


        $('#admin_overview_table').on('draw.dt', function () {
            // Upload new segmentations
            $('.segmentationUploadButton').click(function () {
                let table = $('#admin_overview_table').DataTable();
                let rowObject = table.row($(this).closest('tr')).data();
                showSegmentationUploadModal(rowObject);
            });

            // Download data
            $('.dataDownloadButton').click(function () {
                let table = $('#admin_overview_table').DataTable();
                let rowObject = table.row($(this).closest('tr')).data();
                showDownloadModal(rowObject);

            });
        });
    });

</script>
<table id="admin_overview_table" class="table table-striped table-hover dt-responsive nowrap">
    <thead>
    <tr>
        <th> Data ID</th>
        <th> Status</th>
        <th> Data </th>
    </tr>
    </thead>
</table>

{% endblock %}

{% block forms %}
{% include 'forms/segmentation_upload_form.html' %}
{% include 'forms/download_form.html' %}
{% endblock %}

